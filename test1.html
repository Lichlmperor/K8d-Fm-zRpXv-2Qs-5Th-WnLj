<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Petstore Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif; margin: 10px;
        }
        #pet-list { margin-top: 15px; }
        button {
            font-size: 1em; padding: 7px 17px; border-radius: 7px; border: 1px solid #888;
            margin: 0 5px 7px 0; cursor: pointer;
        }
        .modal, .overlay {
            display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
            justify-content: center; align-items: center;
        }
        .modal {
            z-index: 2; background: #fff; border: 1px solid #333;
            padding: 18px 30px; border-radius: 12px; text-align: center;
            width: 2500px; min-width: 2000px; max-width: 95vw;
            box-sizing: border-box;
        }
        .overlay {
            background: rgba(0,0,0,0.2); z-index: 1;
        }
        .edit-row input, .edit-row select {
            width: 80px; margin-right: 9px; font-size: 1em;
        }
        input, select {
            font-size: 1em; padding: 5px; border-radius: 7px; border: 1px solid #aaa;
        }
        ul {
            padding-left: 0;
        }
        li {
            list-style: none; margin-bottom: 8px; font-size: 1em;
        }
        .edit-row {
            display: flex; gap: 7px; flex-wrap: wrap; margin-bottom: 5px;
        }
        /* мобильная версия */
        @media (max-width: 700px) {
            button { width: 99%; font-size: 1.2em; margin-bottom: 10px; }
            .modal {
                width: 96vw !important; min-width: 0 !important; padding: 17px 7px;
            }
            .edit-row, .edit-row input, .edit-row select {
                flex-direction: column !important; width: 99% !important;
                margin: 2px auto 6px auto !important;
            }
            .edit-row input, .edit-row select { font-size: 1.17em;}
            input, select { width: 97vw !important; font-size: 1.17em;}
            li { font-size: 1.15em; }
        }
    </style>
</head>
<body>
    <button id="show-btn">Показать список Pet ID</button>
    <button id="add-btn">Добавить</button>
    <button id="edit-btn">Редактировать</button>
    <div id="pet-list"></div>

    <div id="overlay" class="overlay"></div>
    <div id="modal" class="modal">
        <h3 style="margin-top:-3px;">Добавить питомца</h3>
        <input type="number" id="petid-modal" placeholder="petid"><br>
        <input type="text" id="petname-modal" placeholder="имя"><br>
        <select id="petstatus-modal">
            <option value="available">available</option>
            <option value="pending">pending</option>
            <option value="sold">sold</option>
        </select><br>
        <button id="confirm-add">Подтвердить</button>
        <button id="cancel-add">Отмена</button>
    </div>

    <script>
        const statuses = ["available", "pending", "sold"];
        let petList = [];
        let inEditMode = false;

        async function fetchPets() {
            const petIds = [1, 2, 3, 4, 5];
            petList = [];
            const petListDiv = document.getElementById('pet-list');
            petListDiv.innerHTML = 'Загружается...';

            for (const id of petIds) {
                try {
                    const res = await fetch(`https://petstore.swagger.io/v2/pet/${id}`, {
                        method: 'GET',
                        headers: {
                            'accept': 'application/json',
                            'api_key': 'special-key'
                        }
                    });
                    if (!res.ok) {
                        petList.push({ id, name: '', status: '', error: true });
                        continue;
                    }
                    const data = await res.json();
                    petList.push({ id: data.id, name: data.name || '', status: data.status || '', error: false });
                } catch (e) {
                    petList.push({ id, name: '', status: '', error: true });
                }
            }
            renderPetList();
        }

        function renderPetList() {
            const petListDiv = document.getElementById('pet-list');
            if (petList.length === 0) {
                petListDiv.innerHTML = 'Нет данных';
                return;
            }
            let html = '<ul>';
            petList.forEach((pet, idx) => {
                if (pet.error) {
                    html += `<li>petid: ${pet.id} — не найден</li>`;
                } else if (inEditMode) {
                    html += `
                        <li class="edit-row">
                            <input value="${pet.id}" disabled>
                            <input value="${pet.name}" id="edit-name-${idx}">
                            <select id="edit-status-${idx}">
                                ${statuses.map(s => `<option value="${s}" ${pet.status === s ? 'selected' : ''}>${s}</option>`).join('')}
                            </select>
                            <button onclick="saveEdit(${idx})">Сохранить</button>
                        </li>`;
                } else {
                    html += `<li>petid: ${pet.id} — имя: ${pet.name} — статус: ${pet.status}</li>`;
                }
            });
            html += '</ul>';
            petListDiv.innerHTML = html;
        }

        window.saveEdit = async function(idx) {
            const pet = petList[idx];
            const name = document.getElementById('edit-name-' + idx).value;
            const status = document.getElementById('edit-status-' + idx).value;
            const body = {
                id: pet.id,
                name: name,
                photoUrls: [],
                status: status
            };
            const res = await fetch('https://petstore.swagger.io/v2/pet', {
                method: 'PUT',
                headers: {
                    'accept': 'application/json',
                    'Content-Type': 'application/json',
                    'api_key': 'special-key'
                },
                body: JSON.stringify(body)
            });
            if (res.ok) {
                petList[idx].name = name;
                petList[idx].status = status;
                alert('Данные обновлены!');
            } else {
                alert('Ошибка при обновлении');
            }
            renderPetList();
        };

        function showModal() {
            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('modal').style.display = 'flex';
        }
        function hideModal() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('modal').style.display = 'none';
            document.getElementById('petid-modal').value = '';
            document.getElementById('petname-modal').value = '';
            document.getElementById('petstatus-modal').value = statuses[0];
        }

        document.getElementById('show-btn').onclick = fetchPets;

        document.getElementById('add-btn').onclick = showModal;
        document.getElementById('cancel-add').onclick = hideModal;

        document.getElementById('confirm-add').onclick = async function() {
            const id = Number(document.getElementById('petid-modal').value);
            const name = document.getElementById('petname-modal').value;
            const status = document.getElementById('petstatus-modal').value;
            const body = {
                id: id,
                name: name,
                photoUrls: [],
                status: status
            };
            const res = await fetch('https://petstore.swagger.io/v2/pet', {
                method: 'POST',
                headers: {
                    'accept': 'application/json',
                    'Content-Type': 'application/json',
                    'api_key': 'special-key'
                },
                body: JSON.stringify(body)
            });
            alert(res.ok ? 'Питомец добавлен!' : 'Ошибка при добавлении');
            hideModal();
            fetchPets();
        };

        document.getElementById('edit-btn').onclick = function () {
            inEditMode = !inEditMode;
            renderPetList();
        };
    </script>
</body>
</html>
